<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>remote.it Desktop</title>
    <link
      href="https://unpkg.com/euphoria/dist/euphoria.min.css"
      rel="stylesheet"
      type="text/css"
    />
  </head>
  <body class="p-none m-none ff-sans-serif">
    <header
      class="px-md py-md bg-info bb bc-gray-light pb-md df ai-center jc-center"
    >
      <h3 class="m-none upper ls-lg white center">Event Log</h3>
      <button
        onclick="clearLogs()"
        class="fr px-sm py-xs bg-info-darker hov-bg-info-darkest white ba-none txt-md c-pointer ml-auto"
      >
        Clear logs
      </button>
    </header>
    <main class="">
      <div
        id="event-log"
        class="m-none of-auto"
        style="max-height: 600px;"
      ></div>
    </main>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2.2.0/dist/socket.io.js"></script>
  <script>
    var socket = io('https://desktop.rt3.io')
    const log = document.querySelector('#event-log')

    logEvent('error')
    logEvent('connect')
    logEvent('connection')
    logEvent('connection:error')
    logEvent('authorized')
    logEvent('unauthorized')
    logEvent('service:error')
    logEvent('service:connecting')
    logEvent('service:connected')
    logEvent('service:disconnected')
    logEvent('service:updated')
    logEvent('service:tunnel:opened')
    logEvent('service:tunnel:closed')
    logEvent('service:throughput')

    function clearLogs() {
      log.innerHTML = ''
    }

    function logEvent(event) {
      socket.on(event, data => addLog(event, data))
    }

    function addLog(msg, data) {
      const wrapper = document.createElement('div')
      wrapper.classList.add('bb', 'bc-gray-lighter', 'hov-bg-gray-lightest')

      const item = document.createElement('div')
      wrapper.append(item)

      item.classList.add('df', 'ai-center', 'py-sm', 'px-md')

      const date = document.createElement('div')
      date.classList.add('gray', 'mr-md', 'txt-sm')
      date.append(new Date().toLocaleString())
      item.appendChild(date)

      const event = document.createElement('div')
      event.classList.add(
        'info',
        'bold',
        'txt-md',
        'bg-primary-lighter',
        'px-xs',
        'py-xxs',
        'ff-mono'
      )
      event.append(msg)
      item.appendChild(event)

      if (data) {
        const json = document.createElement('pre')
        json.classList.add(
          'bg-gray-darkest',
          'gray-lightest',
          'p-md',
          'm-none',
          'txt-md'
        )
        json.style.display = 'none'
        json.append(JSON.stringify(data, null, 2))

        const toggle = document.createElement('button')
        toggle.innerHTML = 'Show data'
        toggle.classList.add(
          'ml-auto',
          'px-sm',
          'py-xs',
          'bg-gray-lighter',
          'gray-dark',
          'hov-gray-darkest',
          'hov-bg-gray-light',
          'ba-none'
        )
        toggle.addEventListener('click', e => {
          e.preventDefault()
          console.log('TOGGLE')
          json.style.display = json.style.display === 'block' ? 'none' : 'block'
          toggle.innerHTML =
            json.style.display === 'block' ? 'Hide data' : 'Show data'
        })

        item.appendChild(toggle)
        wrapper.appendChild(json)
      }

      log.prepend(wrapper)
    }
    // socket.on('news', function (data) {
    //   console.log(data);
    //   socket.emit('my other event', { my: 'data' });
    // });
  </script>
</html>
